# Transaction Encoding

When sending an interchain account transaction, which is composed of multiple `sdk.Msg`'s represented as `Any`'s, the transaction must be encoded as bytes inside [`InterchainAccountPacketData`](https://github.com/cosmos/ibc-go/blob/v7.2.0/proto/ibc/applications/interchain_accounts/v1/packet.proto#L21-L26).

```protobuf
// InterchainAccountPacketData is comprised of a raw transaction, type of transaction and optional memo field.
message InterchainAccountPacketData {
  Type   type = 1;
  bytes  data = 2;
  string memo = 3;
}
```

The `data` field must be an encoded [`CosmosTx`](https://github.com/cosmos/ibc-go/blob/v7.2.0/proto/ibc/applications/interchain_accounts/v1/packet.proto#L28-L31).

```protobuf
// CosmosTx contains a list of sdk.Msg's. It should be used when sending transactions to an SDK host chain.
message CosmosTx {
  repeated google.protobuf.Any messages = 1;
}
```

There are two ways to encode a `CosmosTx` which is decided during the channel handshake process. If the encoding field of the channel version metadata is set to `proto3`, then the `CosmosTx` is encoded using protobuf. If the encoding field of the channel version metadata is set to `proto3json`, then the `CosmosTx` is encoded using pbjson (a json representation of the protobuf message).

## Protobuf Encoding

The protobuf encoding is the default encoding for `CosmosTx` if the channel handshake is started with the an empty channel version metadata. It can be explicitly specified by setting the encoding field to `proto3`. In golang, the protobuf encoding is done using the `proto.Marshal`. Each protobuf autogenerated golang type has a `Marshal` method that can be used to encode the message.

## (Protobuf) Json Encoding

The protojson encoding is an alternative encoding for `CosmosTx` if the channel handshake is started with the channel version metadata encoding field set to `proto3json`. In golang, the protobuf json encoding is done using the `"github.com/cosmos/gogoproto/jsonpb"` package. In CosmosSDK, `ProtoCodec` struct implements the `JSONCodec` interface using the `jsonpb` package. The produced json has the following format:

```json
{
  "messages": [
    {
      "@type": "/cosmos.bank.v1beta1.MsgSend",
      "from_address": "cosmos1...",
      "to_address": "cosmos1...",
      "amount": [
        {
          "denom": "uatom",
          "amount": "1000000"
        }
      ]
    }
  ]
}
```
