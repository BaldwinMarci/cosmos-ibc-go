version: "3.9"
services:
  hermes:
    # If hermes starts too quickly, it can fail to connect to chain-1 and chain-2 (even though we're using depends_on)
    # after a few restarts it will eventually succeed.
    restart: always
    image: hermes:latest
    depends_on:
      - chain-1
      - chain-2
    entrypoint: ["sleep", "infinity"]

  chain-1:
    image: simd:latest
    entrypoint: ["sleep", "infinity"]
    environment:
      BINARY: "simd"
      CHAIN_ID: "test-1"
      CHAIN_DIR: "./data"
      P2PPORT: "16656"
      RPCPORT: "16657"
      RESTPORT: "1316"
      ROSETTA: "8080"
      GRPCPORT: "8090"
      GRPCWEB: "8091"
    ports:
      - "16656"
      - "16657"
      - "1316"
      - "8080"
      - "8090"
      - "8091"

  chain-2:
    image: simd:latest
    entrypoint: ["sleep", "infinity"]
    environment:
      BINARY: "simd"
      CHAIN_ID: "test-2"
      CHAIN_DIR: "./data"
      P2PPORT: "26656"
      RPCPORT: "26657"
      RESTPORT: "1317"
      ROSETTA: "8081"
      GRPCPORT: "9090"
      GRPCWEB: "9091"
    ports:
      - "26656"
      - "26657:26657"
      - "1317"
      - "8081"
      - "9090"
      - "9091"

# docker run -d -p 8000:8000 -p 9000:9000 --name=portainer --restart=always -v /var/run/docker.sock:/var/run/docker.sock -v portainer_data:/data portainer/portainer-ce